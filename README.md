# Terraform Provider for StorageGrid IAM

The StorageGrid IAM provider allows you to manage StorageGrid users, groups, and access keys.

## Requirements

This provider requires StorageGrid with v4 API support. It is not compatible with older StorageGrid versions that only support v3 or earlier APIs.

## Example Usage

```terraform
provider "storagegrid" {
  endpoint   = "https://storagegrid.example.com"
  accountid  = "12345678901234567890"
  username   = "admin"
  password   = "password"
}
```

## Schema

### Required

- `accountid` (String) Account ID for target StorageGrid tenant. May also be provided via `STORAGEGRID_ACCOUNTID` environment variable.
- `endpoint` (String) URI for StorageGrid API. May also be provided via `STORAGEGRID_ENDPOINT` environment variable.
- `password` (String, Sensitive) Password for StorageGrid tenant. May also be provided via `STORAGEGRID_PASSWORD` environment variable.
- `username` (String) Username for StorageGrid tenant. May also be provided via `STORAGEGRID_USERNAME` environment variable.

---

## Resources

### `storagegrid_group`

Manages a StorageGrid Group.

#### Example Usage

```terraform
resource "storagegrid_group" "example" {
  group_name = "my-group"
  policies {
    s3 = file("${path.module}/policies/s3_policy.json")
    management = {
      root_access = true
    }
  }
}
```

#### Schema

##### Required

- `group_name` (String) The unique name for the group (e.g., 'my-new-group'). The 'group/' prefix is added automatically. This cannot be changed after creation.
- `policies` (Block List, Min: 1) (see below for nested schema)

##### Read-Only

- `account_id` (String) The account ID associated with the group.
- `display_name` (String) The display name of the group.
- `federated` (Boolean) Indicates if the group is federated.
- `group_urn` (String) The URN of the group.
- `id` (String) The unique identifier (ID) for the group, generated by StorageGrid.
- `last_updated` (String) The timestamp of the last update.
- `management_read_only` (Boolean) Indicates if the group has read-only management access.
- `unique_name` (String) The canonical unique name of the group.

<a id="nestedblock--policies"></a>
### Nested Schema for `policies`

Required:

- `s3` (String) The S3 policy for the group, provided as a JSON string. Use the `file()` function to load from a file.

Optional:

- `management` (Block List, Max: 1) (see below for nested schema)

<a id="nestedblock--policies--management"></a>
### Nested Schema for `policies.management`

Optional:

- `manage_all_containers` (Boolean) Permission to manage all containers.
- `manage_endpoints` (Boolean) Permission to manage endpoints.
- `manage_own_container_objects` (Boolean) Permission to manage objects in own containers.
- `manage_own_s3_credentials` (Boolean) Permission to manage own S3 credentials.
- `root_access` (Boolean) Grants root access permissions to the group.
- `view_all_containers` (Boolean) Permission to view all containers.

---

### `storagegrid_user`

Manages a StorageGrid User.

#### Example Usage

```terraform
resource "storagegrid_user" "example" {
  user_name = "my-user"
  full_name = "My User"
  member_of = ["my-group"]
}
```

#### Schema

##### Required

- `user_name` (String) The unique name for the user (e.g., 'Test1'). The 'user/' prefix is added automatically. This cannot be changed after creation.

##### Optional

- `disable` (Boolean) Set to true to disable the user account. Defaults to false.
- `full_name` (String) The user's full name. If omitted, it defaults to the value of 'user_name'.
- `member_of` (List of String) A list of group names that the user should be a member of. The groups must already exist.

##### Read-Only

- `account_id` (String) The account ID associated with the user.
- `federated` (Boolean) Indicates if the user is federated.
- `id` (String) The unique identifier (ID) for the user, generated by StorageGrid.
- `last_updated` (String) The timestamp of the last update.
- `unique_name` (String) The canonical unique name of the user.
- `user_urn` (String) The URN of the user.

---

### `storagegrid_access_keys`

Manages a StorageGrid S3 Access Key for a specific user.

#### Example Usage

```terraform
resource "storagegrid_access_keys" "example" {
  user_name    = "my-user"
  created_date = timestamp()
}
```

#### Schema

##### Required

- `created_date` (String) A timestamp of when the key was created in Terraform. Changing this value will force a new key to be generated.
- `user_name` (String) The name of the user for whom the access key will be created.

##### Optional

- `expires` (String) The expiration date for the access key in ISO 8601 format (e.g., '2028-09-04T00:00:00.000Z'). If omitted, the key will not expire.

##### Read-Only

- `access_key` (String, Sensitive) The S3 access key. This value is only available upon creation and is stored in the Terraform state.
- `account_id` (String) The account ID to which the user belongs.
- `display_name` (String) The display name of the access key.
- `id` (String) The unique identifier for the access key, generated by StorageGrid.
- `secret_access_key` (String, Sensitive) The S3 secret access key. This value is only available upon creation and is stored in the Terraform state.
- `user_id` (String) The internal ID of the user.
- `user_urn` (String) The URN of the user associated with the access key.

---

## Data Sources

### `storagegrid_group`

Fetches information about a StorageGrid Group.

#### Example Usage

```terraform
data "storagegrid_group" "example" {
  group_name = "my-group"
}
```

#### Schema

##### Required

- `group_name` (String) The unique name of the group to fetch (e.g., 'group/example').

##### Read-Only

- `api_version` (String) The version of the API.
- `data` (List of Object) (see below for nested schema)
- `status` (String) The status of the API response.

<a id="nestedatt--data"></a>
### Nested Schema for `data`

Read-Only:

- `account_id` (String)
- `display_name` (String)
- `federated` (Boolean)
- `group_urn` (String)
- `id` (String)
- `management_read_only` (Boolean)
- `policies` (List of Object) (see below for nested schema)
- `unique_name` (String)

<a id="nestedobjatt--data--policies"></a>
### Nested Schema for `data.policies`

Read-Only:

- `management` (List of Object) (see below for nested schema)
- `s3` (List of Object) (see below for nested schema)

<a id="nestedobjatt--data--policies--management"></a>
### Nested Schema for `data.policies.management`

Read-Only:

- `manage_all_containers` (Boolean)
- `manage_endpoints` (Boolean)
- `manage_own_container_objects` (Boolean)
- `manage_own_s3_credentials` (Boolean)
- `root_access` (Boolean)
- `view_all_containers` (Boolean)

<a id="nestedobjatt--data--policies--s3"></a>
### Nested Schema for `data.policies.s3`

Read-Only:

- `statement` (List of Object) (see below for nested schema)
- `version` (String)

<a id="nestedobjatt--data--policies--s3--statement"></a>
### Nested Schema for `data.policies.s3.statement`

Read-Only:

- `action` (List of String)
- `effect` (String)
- `resource` (List of String)

---

### `storagegrid_user`

Fetches information about a StorageGrid User.

#### Example Usage

```terraform
data "storagegrid_user" "example" {
  user_name = "my-user"
}
```

#### Schema

##### Required

- `user_name` (String) The unique name of the user to fetch (e.g., 'user/Test').

##### Read-Only

- `api_version` (String) The version of the API.
- `data` (List of Object) (see below for nested schema)
- `status` (String) The status of the API response.

<a id="nestedatt--data"></a>
### Nested Schema for `data`

Read-Only:

- `account_id` (String)
- `disable` (Boolean)
- `federated` (Boolean)
- `full_name` (String)
- `id` (String)
- `member_of` (List of String)
- `unique_name` (String)
- `user_urn` (String)
